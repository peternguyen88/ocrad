console.log('Replace Signin JS');
var sgnItem=function(e){this.msg=ko.observable(e.msg),this.err=ko.observable(e.err),this.setAuthy=ko.observable(e.setAuthy),this.msgErrAuthy=ko.observable(e.msgErrAuthy),this.msgErrCaptcha=ko.observable(e.msgErrCaptcha),this.callback=e.callback},UserAccess=function(){var e=this;e.Access=ko.observable(),e.AuthyProtected=!1,this.init=function(){e.Access(new sgnItem({msg:"",err:0,setAuthy:0,msgErrAuthy:"",msgErrCaptcha:"",callback:""})),ko.applyBindings(e,$("#div-binding-container")[0])},this.Resend=function(){$("#btn-resend").blur();var t=!0;if(null==grecaptcha.getResponse()||grecaptcha.getResponse().length<15)return e.Access().msgErrCaptcha("Please confirm that you are not a robot"),void setTimeout(function(){e.Access().msgErrCaptcha("")},3e3);var r=$("#input-sign-username").val().trim(),s=$('input[name="__RequestVerificationToken"]').val(),i=new Validation;i.Email(r)?(r.indexOf("yopmail.com")>-1||r.trim().indexOf(" ")>-1)&&(e.Access().err(1),e.Access().msg("Email is invalid"),t=!1):(e.Access().err(1),r.length>0?e.Access().msg("Email is invalid"):e.Access().msg("Email cannot empty"),t=!1),t&&$.ajax({url:urlResend,data:{email:r,__RequestVerificationToken:s},type:"POST",dataType:"json",beforeSend:function(){$("#btn-resend img").attr("src","/Content/images/Gear_white.gif").addClass("fa-loading-gear"),$("#btn-resend").attr("disabled",!0)},success:function(t){if("OK"==t.Result){var r=[];r.push('<div class="alert alert-primary alert-dismissible fade in">'),r.push('<div class="form-group">'),null!=t.Message&&"101"==t.Message?r.push('<div>Your account already activated. <a href="/Account/ForgotPassword">Forgot your password?</a></div>'):r.push("<div>We have sent you an email to activate your account. Please log in the email you have registered. In case of not finding the email in your Inbox, check other folders (Junk, Spamâ€¦), then follow our constructions to activate your account</div>"),r.push("</div>"),r.push("</div>"),$("#div-binding-container").html(r.join("")),$("#div-binding-container").css("padding","40px").addClass("text-center")}else e.Access().Message("Email does not register yet"),e.Access().err(1);$("#btn-resend img").attr("src","/Content/images/arrow-right.png").removeClass("fa-loading-gear"),$("#btn-resend").removeAttr("disabled")}})},this.Login=function(){var t=$("#input-sign-password").val().trim(),r=$("#input-sign-username").val().trim(),s="";if(r.length<3||t.length<6)return e.Access().msg("Email or password is incorrect"),void e.Access().err(1);if(1==e.AuthyProtected&&(s=$('input[name="authy"]').val(),0==s.trim().length))return void e.Access().msgErrAuthy("Please input your Google Verificator Code");var i=$('input[name="__RequestVerificationToken"]').val(),n=BrowserDetect.browser;$.ajax({url:urlAccess,data:{Email:r,Password:t,authyCode:s,type:e.Access().callback,id:0,client_browswer:n,__RequestVerificationToken:i},type:"POST",dataType:"json",beforeSend:function(){$("#btn-signin img").attr("src","/Content/images/Gear_white.gif").addClass("fa-loading-gear"),$("#btn-signin").attr("disabled",!0)},success:function(t){"OK"==t.Result?null!=t.Message?"LimitAccess"==t.Message?bootbox.dialog({message:"Only members who deposited BTC or ETH are allowed to sign up to buy UCH when the ICO takes place. We will unlock the sign-in function for you soon. We are so sorry for this inconvenience",title:"Alert",buttons:{confirm:{label:'<i class="fa fa-times"></i> Close',className:"btn-warning button-bootbox-close"}}}):"ProtectedByAuthy"==t.Message?(e.Access().setAuthy(1),e.AuthyProtected=!0,$("#btn-signin img").attr("src","/Content/images/arrow-right.png").removeClass("fa-loading-gear"),$("#btn-signin").removeAttr("disabled")):"ProtectedByEmail"==t.Message&&(window.location.href="/email-login"):0==t.Data.VerifyType&&(window.location.href=t.Data.RedirectUrl):($("#btn-signin img").attr("src","/Content/images/arrow-right.png").removeClass("fa-loading-gear"),$("#btn-signin").removeAttr("disabled"),e.Access().msg("Email or password is incorrect"),e.Access().err(1))},error:function(t){$("#btn-signin img").attr("src","/Content/images/arrow-right.png").removeClass("fa-loading-gear"),$("#btn-signin").removeAttr("disabled"),e.Access().msg("Email or password is incorrect"),e.Access().err(1),e.Login()}})}},BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown"},searchString:function(e){for(var t=0;t<e.length;t++){var r=e[t].string;if(this.versionSearchString=e[t].subString,-1!==r.indexOf(e[t].subString))return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!==t){var r=e.indexOf("rv:");return"Trident"===this.versionSearchString&&-1!==r?parseFloat(e.substring(r+3)):parseFloat(e.substring(t+this.versionSearchString.length+1))}},dataBrowser:[{string:navigator.userAgent,subString:"Edge",identity:"MS Edge"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"},{string:navigator.userAgent,subString:"OPR",identity:"Opera"},{string:navigator.userAgent,subString:"coc_coc_browser",identity:"CocCoc"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"}]};$(document).ready(function(){BrowserDetect.init();var e=new UserAccess;e.init(),$("#input-sign-password").keydown(function(t){13==t.keyCode&&e.Login()})});
